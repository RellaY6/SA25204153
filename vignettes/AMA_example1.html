<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="SA25204153 杨羽佳" />

<meta name="date" content="2025-12-22" />

<title>Adaptive Model Averaging (AMA) Example 1 数值实验说明</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Adaptive Model Averaging (AMA) Example 1
数值实验说明</h1>
<h4 class="author">SA25204153 杨羽佳</h4>
<h4 class="date">2025-12-22</h4>


<div id="TOC">
<ul>
<li><a href="#%E8%83%8C%E6%99%AFama-example-1" id="toc-背景ama-example-1"><span class="toc-section-number">1</span> 1.
背景：AMA Example 1</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0-gen_example1_data" id="toc-数据生成函数-gen_example1_data"><span class="toc-section-number">2</span> 2. 数据生成函数
<code>gen_example1_data()</code></a></li>
<li><a href="#ama-%E6%8B%9F%E5%90%88%E5%87%BD%E6%95%B0-ama_fit_example1" id="toc-ama-拟合函数-ama_fit_example1"><span class="toc-section-number">3</span> 3. AMA 拟合函数
<code>ama_fit_example1()</code></a>
<ul>
<li><a href="#%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8" id="toc-函数作用"><span class="toc-section-number">3.1</span> 3.1
函数作用</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%BA%90%E7%A0%81%E8%8A%82%E9%80%89" id="toc-关键实现源码节选"><span class="toc-section-number">3.2</span>
3.2 关键实现源码节选</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B" id="toc-基本调用示例"><span class="toc-section-number">3.3</span> 3.3
基本调用示例</a></li>
</ul></li>
<li><a href="#%E6%A8%A1%E6%8B%9F%E4%B8%BB%E5%87%BD%E6%95%B0-sim_example1_grid" id="toc-模拟主函数-sim_example1_grid"><span class="toc-section-number">4</span> 4. 模拟主函数
<code>sim_example1_grid()</code></a>
<ul>
<li><a href="#%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E6%A6%82%E8%BF%B0" id="toc-函数作用概述"><span class="toc-section-number">4.1</span> 4.1
函数作用概述</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E5%AE%9E%E7%8E%B0%E6%BA%90%E7%A0%81%E8%8A%82%E9%80%89-1" id="toc-关键实现源码节选-1"><span class="toc-section-number">4.2</span>
4.2 关键实现源码节选</a></li>
<li><a href="#%E7%B2%BE%E7%AE%80%E7%89%88%E7%A4%BA%E4%BE%8Bvignette-%E4%B8%AD%E7%94%A8%E8%BE%83%E5%B0%8F%E8%A7%84%E6%A8%A1" id="toc-精简版示例vignette-中用较小规模"><span class="toc-section-number">4.3</span> 4.3 精简版示例（vignette
中用较小规模）</a>
<ul>
<li><a href="#%E7%BB%93%E6%9E%9C%E5%8F%AF%E8%A7%86%E5%8C%96mrme" id="toc-结果可视化mrme"><span class="toc-section-number">4.3.1</span>
结果可视化（MRME）</a></li>
</ul></li>
</ul></li>
<li><a href="#c-%E5%87%BD%E6%95%B0-compute_me_cpp-%E4%B8%8E-compute_c_ic_cpp" id="toc-c-函数-compute_me_cpp-与-compute_c_ic_cpp"><span class="toc-section-number">5</span> 5. C++ 函数
<code>compute_ME_cpp()</code> 与 <code>compute_C_IC_cpp()</code></a>
<ul>
<li><a href="#c-%E6%BA%90%E7%A0%81" id="toc-c-源码"><span class="toc-section-number">5.1</span> 5.1 C++ 源码</a></li>
<li><a href="#compute_me_cpp-%E7%A4%BA%E4%BE%8B" id="toc-compute_me_cpp-示例"><span class="toc-section-number">5.2</span>
5.2 <code>compute_ME_cpp()</code> 示例</a></li>
<li><a href="#compute_c_ic_cpp-%E7%A4%BA%E4%BE%8B" id="toc-compute_c_ic_cpp-示例"><span class="toc-section-number">5.3</span> 5.3
<code>compute_C_IC_cpp()</code> 示例</a></li>
<li><a href="#%E9%80%9F%E5%BA%A6%E5%AF%B9%E6%AF%94r-vs-rcppmicrobenchmark" id="toc-速度对比r-vs-rcppmicrobenchmark"><span class="toc-section-number">5.4</span> 5.4 速度对比：R vs
Rcpp（microbenchmark）</a></li>
</ul></li>
<li><a href="#%E5%B0%8F%E7%BB%93" id="toc-小结"><span class="toc-section-number">6</span> 6. 小结</a></li>
</ul>
</div>

<div id="背景ama-example-1" class="section level1" number="1">
<h1><span class="header-section-number">1</span> 1. 背景：AMA Example
1</h1>
<p>本小结基于 Zhang (2022) 提出的 <strong>Adaptive Model Averaging
(AMA)</strong> 方法，复现文中的 Numerical Example 1。</p>
<ul>
<li><p>数据生成：高维线性模型<br />
<span class="math display">\[
  y = X \beta_0 + \varepsilon,\quad
  X \sim \mathcal{N}(0, \Sigma),\quad
  \varepsilon \sim \mathcal{N}(0, \sigma^2 I_n),
\]</span> 其中协方差矩阵 <span class="math inline">\(\Sigma\)</span>
具有 AR(1) 结构，真系数 <span class="math inline">\(\beta_0\)</span>
只有前 <span class="math inline">\(3q\)</span> 个分量非零。</p></li>
<li><p>目标：比较三种估计方法的模型误差与稀疏性表现：</p>
<ol style="list-style-type: decimal">
<li>AMA（自适应模型平均）；</li>
<li>ALASSO + mBIC 单模型选择；</li>
<li>ALASSO + eBIC 单模型选择。</li>
</ol></li>
</ul>
<p>本 R 包实现了 Example 1 中的主要步骤，并提供了 4 个核心函数：</p>
<ul>
<li><code>ama_fit_example1()</code>：在给定数据上一条龙跑完 AMA Step
1–6；</li>
<li><code>sim_example1_grid()</code>：在一组 <span class="math inline">\((n, \rho, R^2)\)</span> 组合下做 Monte Carlo
模拟比较；</li>
<li><code>compute_ME_cpp()</code>：在 C++ 中计算模型误差 <span class="math inline">\(ME(\hat\beta)\)</span>；</li>
<li><code>compute_C_IC_cpp()</code>：在 C++ 中计算稀疏性指标 C /
IC。</li>
</ul>
<p>下面依次说明这些函数的用途和基本用法。</p>
</div>
<div id="数据生成函数-gen_example1_data" class="section level1" number="2">
<h1><span class="header-section-number">2</span> 2. 数据生成函数
<code>gen_example1_data()</code></h1>
<p>它根据给定的 <span class="math inline">\((n, \rho, R^2)\)</span>
生成一组模拟数据。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> SA25204153<span class="sc">:::</span><span class="fu">gen_example1_data</span>(<span class="at">n =</span> <span class="dv">200</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">R2 =</span> <span class="fl">0.4</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">str</span>(dat, <span class="at">max.level =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## List of 8
##  $ X      : num [1:200, 1:51] -0.27868 1.39208 -1.47832 -2.3647 -0.00183 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##  $ y      : num [1:200] -26.3 19.5 44.8 -19.8 -39.3 ...
##  $ beta0  : num [1:51] 3 3 3 3 3 3 3 3 3 3 ...
##  $ Sigma  : num [1:51, 1:51] 1 0.5 0.25 0.125 0.0625 ...
##  $ sigma2 : num 554
##  $ p      : num 51
##  $ q      : num 5
##  $ nonzero: num 15</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>gen_example1_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">R2 =</span> <span class="fl">0.4</span>) {</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="do">## 1. 维度：p_n = [4 n^{1/2}] - 5</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">floor</span>(<span class="fu">sqrt</span>(n)) <span class="sc">-</span> <span class="dv">5</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="do">## 2. q = [p_n / 9], 非零个数 |A| = 3q</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  q  <span class="ot">&lt;-</span> <span class="fu">floor</span>(p <span class="sc">/</span> <span class="dv">9</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  nonzero <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">*</span> q</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">stopifnot</span>(nonzero <span class="sc">&lt;=</span> p)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  </span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  <span class="do">## 3. 协方差矩阵</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  idx   <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>p</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> rho<span class="sc">^</span><span class="fu">abs</span>(<span class="fu">outer</span>(idx, idx, <span class="st">&quot;-&quot;</span>))</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  </span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="do">## 4. 真系数</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  beta0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">3</span>, nonzero), <span class="fu">rep</span>(<span class="dv">0</span>, p <span class="sc">-</span> nonzero))</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  </span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  <span class="do">## 5. 生成 X ~ N(0, Sigma)</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>  X <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n, <span class="at">mu =</span> <span class="fu">rep</span>(<span class="dv">0</span>, p), <span class="at">Sigma =</span> Sigma)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  </span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="do">## 6. 根据 R2 决定噪声方差</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  var_signal <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">t</span>(beta0) <span class="sc">%*%</span> Sigma <span class="sc">%*%</span> beta0)</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>  sigma2     <span class="ot">&lt;-</span> var_signal <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> R2) <span class="sc">/</span> R2</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>  eps        <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(sigma2))</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>  </span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>  <span class="do">## 7. 生成 y</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(X <span class="sc">%*%</span> beta0 <span class="sc">+</span> eps)</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>  </span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>    <span class="at">X       =</span> X,</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>    <span class="at">y       =</span> y,</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>    <span class="at">beta0   =</span> beta0,</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>    <span class="at">Sigma   =</span> Sigma,</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>    <span class="at">sigma2  =</span> sigma2,</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>    <span class="at">p       =</span> p,</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>    <span class="at">q       =</span> q,</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>    <span class="at">nonzero =</span> nonzero</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>  )</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>}</span></code></pre></div>
<p>输出列表中包含：</p>
<ul>
<li><code>X</code>：<span class="math inline">\(n \times p\)</span>
设计矩阵；</li>
<li><code>y</code>：长度为 <span class="math inline">\(n\)</span>
的响应向量；</li>
<li><code>beta0</code>：真系数向量；</li>
<li><code>Sigma</code>：协方差矩阵；</li>
<li>以及若干用于描述维度设置的参数。</li>
</ul>
</div>
<div id="ama-拟合函数-ama_fit_example1" class="section level1" number="3">
<h1><span class="header-section-number">3</span> 3. AMA 拟合函数
<code>ama_fit_example1()</code></h1>
<div id="函数作用" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> 3.1 函数作用</h2>
<p><code>ama_fit_example1()</code> 对给定的 <span class="math inline">\((X, y)\)</span> 完成 AMA 的完整流程：</p>
<ol style="list-style-type: decimal">
<li>Step 1：通过 LARS 实现 Adaptive LASSO，得到一条解路径；</li>
<li>Step 2：用 mBIC 从路径中选出候选变量集合 <span class="math inline">\(H\)</span>；</li>
<li>Step 3–4：围绕 <span class="math inline">\(H\)</span>
构造一族候选模型，并对每个模型做 OLS 拟合；</li>
<li>Step 5–6：在一组 <span class="math inline">\(\phi_n\)</span>
网格上用 Cp-type 准则选择最优 <span class="math inline">\(\hat\phi_n\)</span>，得到最终 AMA 模型平均估计
<span class="math inline">\(\hat\beta(\hat\phi_n)\)</span>。</li>
</ol>
</div>
<div id="关键实现源码节选" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> 3.2
关键实现源码节选</h2>
<p>下面代码块为包内 <code>R/ama_example1.R</code> 中
<code>ama_fit_example1()</code> 的节选：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>ama_fit_example1 <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>                             <span class="at">n_phi_grid =</span> <span class="dv">20</span>,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                             <span class="at">B_mc       =</span> <span class="dv">50</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>                             <span class="at">seed       =</span> <span class="dv">2025</span>) {</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  step1 <span class="ot">&lt;-</span> <span class="fu">ama_step1_alasso_lars</span>(X, y, <span class="at">gamma_alasso =</span> <span class="dv">1</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  step2 <span class="ot">&lt;-</span> <span class="fu">ama_step2_select_H_mBIC</span>(X, y, step1)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  step34 <span class="ot">&lt;-</span> <span class="fu">ama_step34_build_candidates</span>(X, y, step1, step2)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  step56 <span class="ot">&lt;-</span> <span class="fu">ama_step5_6_section3</span>(</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    X, y,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    <span class="at">step2_res  =</span> step2,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    <span class="at">step34_res =</span> step34,</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="at">n_phi_grid =</span> n_phi_grid,</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="at">B_mc       =</span> B_mc,</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    <span class="at">seed       =</span> seed</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  )</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    <span class="at">beta_ma        =</span> step56<span class="sc">$</span>beta_ma,</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>    <span class="at">phi_hat        =</span> step56<span class="sc">$</span>phi_hat,</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>    <span class="at">w_hat          =</span> step56<span class="sc">$</span>w_hat,</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>    <span class="at">sigma2_hat     =</span> step56<span class="sc">$</span>sigma2_hat,</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    <span class="at">H              =</span> step2<span class="sc">$</span>H,</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    <span class="at">candidate_sets =</span> step34<span class="sc">$</span>candidate_sets,</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>    <span class="at">step1          =</span> step1,</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    <span class="at">step2          =</span> step2,</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>    <span class="at">step34         =</span> step34,</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>    <span class="at">step56         =</span> step56</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>  )</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>}</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>ama_step1_alasso_lars <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, <span class="at">gamma_alasso =</span> <span class="dv">1</span>, <span class="at">tol_active =</span> <span class="fl">1e-8</span>) {</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>  <span class="co"># X: n x p design matrix</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>  <span class="co"># y: length-n response vector</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>  <span class="co"># gamma_alasso: exponent in ALASSO weights (default gamma_alasso = 1)</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>  <span class="co"># tol_active: threshold to decide &#39;nonzero&#39; coefficients</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>  </span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X), <span class="fu">length</span>(y) <span class="sc">==</span> <span class="fu">nrow</span>(X))</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X); p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>  </span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>  <span class="cf">if</span> (p <span class="sc">&gt;=</span> n) {</span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;Current p &gt;= n. This violates the Example 1 setting (p &lt; n). OLS init may be unstable.&quot;</span>)</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>  }</span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>  </span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>  <span class="do">## 0. Preprocessing: scale X and center y</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>  X_scaled   <span class="ot">&lt;-</span> <span class="fu">scale</span>(X)</span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a>  y_centered <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(y, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">FALSE</span>))</span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>  </span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>  <span class="do">## 1. Initial estimator beta^(init): OLS</span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>  lm_init   <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_centered <span class="sc">~</span> X_scaled)</span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a>  beta_init <span class="ot">&lt;-</span> <span class="fu">coef</span>(lm_init)[<span class="sc">-</span><span class="dv">1</span>]  <span class="co"># drop intercept</span></span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a>  </span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a>  <span class="do">## 2. Build ALASSO weights</span></span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a>  eps     <span class="ot">&lt;-</span> <span class="fl">1e-6</span></span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="fu">abs</span>(beta_init) <span class="sc">+</span> eps)<span class="sc">^</span>gamma_alasso</span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a>  </span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a>  <span class="do">## 3. Rescale design: X*_j = X_scaled_j / w_j</span></span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a>  X_star <span class="ot">&lt;-</span> <span class="fu">sweep</span>(X_scaled, <span class="dv">2</span>, weights, <span class="at">FUN =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a>  </span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a>  <span class="do">## 4. Run LARS-LASSO path on (X*, y_centered)</span></span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;lars&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Package &#39;lars&#39; is required. Please install it first.&quot;</span>)</span>
<span id="cb4-63"><a href="#cb4-63" tabindex="-1"></a>  }</span>
<span id="cb4-64"><a href="#cb4-64" tabindex="-1"></a>  </span>
<span id="cb4-65"><a href="#cb4-65" tabindex="-1"></a>  lars_fit <span class="ot">&lt;-</span> lars<span class="sc">::</span><span class="fu">lars</span>(</span>
<span id="cb4-66"><a href="#cb4-66" tabindex="-1"></a>    <span class="at">x          =</span> X_star,</span>
<span id="cb4-67"><a href="#cb4-67" tabindex="-1"></a>    <span class="at">y          =</span> y_centered,</span>
<span id="cb4-68"><a href="#cb4-68" tabindex="-1"></a>    <span class="at">type       =</span> <span class="st">&quot;lasso&quot;</span>,</span>
<span id="cb4-69"><a href="#cb4-69" tabindex="-1"></a>    <span class="at">normalize  =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-70"><a href="#cb4-70" tabindex="-1"></a>    <span class="at">intercept  =</span> <span class="cn">TRUE</span></span>
<span id="cb4-71"><a href="#cb4-71" tabindex="-1"></a>  )</span>
<span id="cb4-72"><a href="#cb4-72" tabindex="-1"></a>  </span>
<span id="cb4-73"><a href="#cb4-73" tabindex="-1"></a>  beta_lars_path   <span class="ot">&lt;-</span> lars_fit<span class="sc">$</span>beta  <span class="co"># K x p</span></span>
<span id="cb4-74"><a href="#cb4-74" tabindex="-1"></a>  beta_alasso_path <span class="ot">&lt;-</span> <span class="fu">sweep</span>(beta_lars_path, <span class="dv">2</span>, weights, <span class="at">FUN =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb4-75"><a href="#cb4-75" tabindex="-1"></a>  </span>
<span id="cb4-76"><a href="#cb4-76" tabindex="-1"></a>  <span class="do">## 5. Extract the active set at each step</span></span>
<span id="cb4-77"><a href="#cb4-77" tabindex="-1"></a>  K <span class="ot">&lt;-</span> <span class="fu">nrow</span>(beta_alasso_path)</span>
<span id="cb4-78"><a href="#cb4-78" tabindex="-1"></a>  active_sets <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, K)</span>
<span id="cb4-79"><a href="#cb4-79" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_len</span>(K)) {</span>
<span id="cb4-80"><a href="#cb4-80" tabindex="-1"></a>    bk <span class="ot">&lt;-</span> beta_alasso_path[k, ]</span>
<span id="cb4-81"><a href="#cb4-81" tabindex="-1"></a>    active_sets[[k]] <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(bk) <span class="sc">&gt;</span> tol_active)</span>
<span id="cb4-82"><a href="#cb4-82" tabindex="-1"></a>  }</span>
<span id="cb4-83"><a href="#cb4-83" tabindex="-1"></a>  </span>
<span id="cb4-84"><a href="#cb4-84" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb4-85"><a href="#cb4-85" tabindex="-1"></a>    <span class="at">X_scaled         =</span> X_scaled,</span>
<span id="cb4-86"><a href="#cb4-86" tabindex="-1"></a>    <span class="at">y_centered       =</span> y_centered,</span>
<span id="cb4-87"><a href="#cb4-87" tabindex="-1"></a>    <span class="at">beta_init        =</span> beta_init,</span>
<span id="cb4-88"><a href="#cb4-88" tabindex="-1"></a>    <span class="at">weights          =</span> weights,</span>
<span id="cb4-89"><a href="#cb4-89" tabindex="-1"></a>    <span class="at">lars_fit         =</span> lars_fit,</span>
<span id="cb4-90"><a href="#cb4-90" tabindex="-1"></a>    <span class="at">beta_alasso_path =</span> beta_alasso_path,</span>
<span id="cb4-91"><a href="#cb4-91" tabindex="-1"></a>    <span class="at">active_sets      =</span> active_sets</span>
<span id="cb4-92"><a href="#cb4-92" tabindex="-1"></a>  )</span>
<span id="cb4-93"><a href="#cb4-93" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="基本调用示例" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> 3.3 基本调用示例</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># 生成一组 Example 1 数据</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> SA25204153<span class="sc">:::</span><span class="fu">gen_example1_data</span>(<span class="at">n =</span> <span class="dv">200</span>, <span class="at">rho =</span> <span class="fl">0.5</span>, <span class="at">R2 =</span> <span class="fl">0.4</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># 跑一次 AMA 拟合（为了 vignette 速度，这里减小 MC 次数）</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>fit_ama <span class="ot">&lt;-</span> <span class="fu">ama_fit_example1</span>(</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="at">X          =</span> dat<span class="sc">$</span>X,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="at">y          =</span> dat<span class="sc">$</span>y,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="at">n_phi_grid =</span> <span class="dv">5</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="at">B_mc       =</span> <span class="dv">10</span>,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="at">seed       =</span> <span class="dv">2025</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="fu">names</span>(fit_ama)</span></code></pre></div>
<pre><code>##  [1] &quot;beta_ma&quot;        &quot;phi_hat&quot;        &quot;w_hat&quot;          &quot;sigma2_hat&quot;    
##  [5] &quot;H&quot;              &quot;candidate_sets&quot; &quot;step1&quot;          &quot;step2&quot;         
##  [9] &quot;step34&quot;         &quot;step56&quot;</code></pre>
<p>返回结果中：</p>
<ul>
<li><code>beta_ma</code>：最终 AMA 模型平均估计 <span class="math inline">\(\hat\beta(\hat\phi_n)\)</span>；</li>
<li><code>phi_hat</code>：选出的 <span class="math inline">\(\hat\phi_n\)</span>；</li>
<li><code>w_hat</code>：候选模型的模型平均权重；</li>
<li><code>sigma2_hat</code>：基于集合 <span class="math inline">\(H\)</span> 的噪声方差估计；</li>
<li><code>H</code>：mBIC 选出的候选变量集合；</li>
<li><code>candidate_sets</code>：Step 2+3 构造的所有候选模型；</li>
<li><code>step1</code>, <code>step2</code>, <code>step34</code>,
<code>step56</code>：对应各步骤的完整中间结果。</li>
</ul>
<p>查看非零系数个数：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">abs</span>(fit_ama<span class="sc">$</span>beta_ma) <span class="sc">&gt;</span> <span class="fl">1e-6</span>)</span></code></pre></div>
<pre><code>## [1] 14</code></pre>
</div>
</div>
<div id="模拟主函数-sim_example1_grid" class="section level1" number="4">
<h1><span class="header-section-number">4</span> 4. 模拟主函数
<code>sim_example1_grid()</code></h1>
<div id="函数作用概述" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> 4.1 函数作用概述</h2>
<p><code>sim_example1_grid()</code> 在一组 <span class="math inline">\((n, \rho, R^2)\)</span> 组合上重复模拟（默认
<code>B_rep = 100</code> 次），比较三种方法的表现：</p>
<ul>
<li>输出指标：
<ul>
<li>MRME：模型误差相对 LS 的中位数；</li>
<li>C：真正为零且估计为 0 的系数个数（越大越好）；</li>
<li>IC：真正非零却估计为 0 的系数个数（越小越好）。</li>
</ul></li>
</ul>
</div>
<div id="关键实现源码节选-1" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> 4.2
关键实现源码节选</h2>
<p>下面代码块为包内 <code>R/ama_example1.R</code> 中
<code>sim_example1_grid()</code> 的原样节选：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>sim_example1_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="at">n_vec      =</span> <span class="dv">200</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="at">rho_vec    =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.75</span>),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="at">R2_vec     =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>),</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="at">B_rep      =</span> <span class="dv">100</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="at">n_phi_grid =</span> <span class="dv">20</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="at">B_mc       =</span> <span class="dv">50</span>,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="at">seed       =</span> <span class="dv">2025</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>) {</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  res_all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    <span class="at">n      =</span> <span class="fu">integer</span>(<span class="dv">0</span>),</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    <span class="at">rho    =</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="at">R2     =</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    <span class="at">MRME   =</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>    <span class="at">C      =</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>    <span class="at">IC     =</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>  )</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> n_vec) {</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>    <span class="cf">for</span> (rho <span class="cf">in</span> rho_vec) {</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>      <span class="cf">for</span> (R2 <span class="cf">in</span> R2_vec) {</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">&quot;Running n =&quot;</span>, n, <span class="st">&quot;, rho =&quot;</span>, rho, <span class="st">&quot;, R2 =&quot;</span>, R2, <span class="st">&quot;...</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>        </span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>        res_one <span class="ot">&lt;-</span> <span class="fu">sim_example1_one_setting</span>(</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>          <span class="at">n          =</span> n,</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>          <span class="at">rho        =</span> rho,</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>          <span class="at">R2         =</span> R2,</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>          <span class="at">B_rep      =</span> B_rep,</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>          <span class="at">n_phi_grid =</span> n_phi_grid,</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>          <span class="at">B_mc       =</span> B_mc,</span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>          <span class="at">seed       =</span> seed</span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>        )</span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>        </span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>        methods <span class="ot">&lt;-</span> <span class="fu">names</span>(res_one<span class="sc">$</span>MRME)</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>        </span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>        df_tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>          <span class="at">n      =</span> <span class="fu">rep</span>(n,    <span class="fu">length</span>(methods)),</span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>          <span class="at">rho    =</span> <span class="fu">rep</span>(rho,  <span class="fu">length</span>(methods)),</span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>          <span class="at">R2     =</span> <span class="fu">rep</span>(R2,   <span class="fu">length</span>(methods)),</span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a>          <span class="at">method =</span> methods,</span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a>          <span class="at">MRME   =</span> <span class="fu">as.numeric</span>(res_one<span class="sc">$</span>MRME),</span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>          <span class="at">C      =</span> <span class="fu">as.numeric</span>(res_one<span class="sc">$</span>C),</span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a>          <span class="at">IC     =</span> <span class="fu">as.numeric</span>(res_one<span class="sc">$</span>IC),</span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a>        )</span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a>        </span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a>        res_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_all, df_tmp)</span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a>      }</span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a>    }</span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a>  }</span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a>  </span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a>  res_all</span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="精简版示例vignette-中用较小规模" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> 4.3
精简版示例（vignette 中用较小规模）</h2>
<p>为了控制 knit 时间，这里用一个非常小的设定作为演示：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>res_demo <span class="ot">&lt;-</span> <span class="fu">sim_example1_grid</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="at">n_vec      =</span> <span class="dv">200</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="at">rho_vec    =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">R2_vec     =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>),</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">B_rep      =</span> <span class="dv">10</span>,   <span class="co"># 演示时减小重复次数</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="at">n_phi_grid =</span> <span class="dv">5</span>,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="at">B_mc       =</span> <span class="dv">10</span>,</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="at">seed       =</span> <span class="dv">2025</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running n = 200 , rho = 0.5 , R2 = 0.2 ...
## rep 10 done
## Running n = 200 , rho = 0.5 , R2 = 0.4 ...
## rep 10 done</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>res_demo</span></code></pre></div>
<pre><code>##     n rho  R2      method      MRME    C   IC
## 1 200 0.5 0.2         AMA 0.4764999 25.4  8.0
## 2 200 0.5 0.2 ALASSO_mBIC 0.4981187 35.4 12.0
## 3 200 0.5 0.2 ALASSO_eBIC 0.6956057 28.1  8.3
## 4 200 0.5 0.4         AMA 0.5384671 29.0  5.6
## 5 200 0.5 0.4 ALASSO_mBIC 0.7303601 35.4  9.8
## 6 200 0.5 0.4 ALASSO_eBIC 0.6292338 29.9  5.8</code></pre>
<div id="结果可视化mrme" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span>
结果可视化（MRME）</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">ggplot</span>(res_demo, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(R2), <span class="at">y =</span> MRME, <span class="at">fill =</span> method)) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> rho, <span class="at">labeller =</span> <span class="fu">label_bquote</span>(rho <span class="sc">==</span> .(rho))) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(R<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;MRME（相对 LS 的中位数）&quot;</span>,</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;不同设定下 MRME 对比&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="c-函数-compute_me_cpp-与-compute_c_ic_cpp" class="section level1" number="5">
<h1><span class="header-section-number">5</span> 5. C++ 函数
<code>compute_ME_cpp()</code> 与 <code>compute_C_IC_cpp()</code></h1>
<p>在 Example 1 的模拟中，我们反复需要计算：</p>
<ul>
<li>模型误差<br />
<span class="math display">\[
  ME(\hat\beta) = (\hat\beta - \beta_0)^\top \Sigma (\hat\beta -
\beta_0),
\]</span></li>
<li>稀疏性指标 C / IC：
<ul>
<li>C：真零系数中被估计为 0 的个数；</li>
<li>IC：真正非零却被估计为 0 的个数。</li>
</ul></li>
</ul>
<p>为了提高效率，这两个计算被实现为 Rcpp 函数：</p>
<ul>
<li><code>compute_ME_cpp(beta_hat, beta0, Sigma)</code></li>
<li><code>compute_C_IC_cpp(beta_hat, beta0, tol = 1e-6)</code></li>
</ul>
<p>下面给出可直接复现的最小示例，并在 vignette 内部提供一个“纯
R”版本用于速度对比。</p>
<div id="c-源码" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> 5.1 C++ 源码</h2>
<p>下面代码块为包内 <code>src/ama_utils.cpp</code> 的原样节选，其中包含
<code>compute_ME_cpp()</code> 与 <code>compute_C_IC_cpp()</code> 的
C++/Rcpp 实现</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="dt">double</span> compute_ME_cpp<span class="op">(</span><span class="at">const</span> NumericVector<span class="op">&amp;</span> beta_hat<span class="op">,</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>                      <span class="at">const</span> NumericVector<span class="op">&amp;</span> beta0<span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>                      <span class="at">const</span> NumericMatrix<span class="op">&amp;</span> Sigma<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="dt">int</span> p <span class="op">=</span> beta_hat<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>beta0<span class="op">.</span>size<span class="op">()</span> <span class="op">!=</span> p<span class="op">)</span> stop<span class="op">(</span><span class="st">&quot;beta_hat and beta0 must have the same length.&quot;</span><span class="op">);</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>Sigma<span class="op">.</span>nrow<span class="op">()</span> <span class="op">!=</span> p <span class="op">||</span> Sigma<span class="op">.</span>ncol<span class="op">()</span> <span class="op">!=</span> p<span class="op">)</span> stop<span class="op">(</span><span class="st">&quot;Sigma must be a p x p matrix.&quot;</span><span class="op">);</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>  <span class="dt">double</span> me <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> p<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>    <span class="dt">double</span> di <span class="op">=</span> beta_hat<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> beta0<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>    <span class="dt">double</span> s  <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> p<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>      s <span class="op">+=</span> Sigma<span class="op">(</span>i<span class="op">,</span> j<span class="op">)</span> <span class="op">*</span> <span class="op">(</span>beta_hat<span class="op">[</span>j<span class="op">]</span> <span class="op">-</span> beta0<span class="op">[</span>j<span class="op">]);</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>    me <span class="op">+=</span> di <span class="op">*</span> s<span class="op">;</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>  <span class="cf">return</span> me<span class="op">;</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>NumericVector compute_C_IC_cpp<span class="op">(</span><span class="at">const</span> NumericVector<span class="op">&amp;</span> beta_hat<span class="op">,</span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>                               <span class="at">const</span> NumericVector<span class="op">&amp;</span> beta0<span class="op">,</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a>                               <span class="dt">double</span> tol <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>  <span class="dt">int</span> p <span class="op">=</span> beta_hat<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>beta0<span class="op">.</span>size<span class="op">()</span> <span class="op">!=</span> p<span class="op">)</span> stop<span class="op">(</span><span class="st">&quot;beta_hat and beta0 must have the same length.&quot;</span><span class="op">);</span></span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a>  </span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>  <span class="dt">int</span> C <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> IC <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> p<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-33"><a href="#cb15-33" tabindex="-1"></a>    <span class="dt">bool</span> true_zero <span class="op">=</span> <span class="bu">std::</span>fabs<span class="op">(</span>beta0<span class="op">[</span>j<span class="op">])</span> <span class="op">&lt;</span> tol<span class="op">;</span></span>
<span id="cb15-34"><a href="#cb15-34" tabindex="-1"></a>    <span class="dt">bool</span> est_zero  <span class="op">=</span> <span class="bu">std::</span>fabs<span class="op">(</span>beta_hat<span class="op">[</span>j<span class="op">])</span> <span class="op">&lt;</span> tol<span class="op">;</span></span>
<span id="cb15-35"><a href="#cb15-35" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>true_zero <span class="op">&amp;&amp;</span> est_zero<span class="op">)</span>  <span class="op">++</span>C<span class="op">;</span></span>
<span id="cb15-36"><a href="#cb15-36" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>true_zero <span class="op">&amp;&amp;</span> est_zero<span class="op">)</span> <span class="op">++</span>IC<span class="op">;</span></span>
<span id="cb15-37"><a href="#cb15-37" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb15-38"><a href="#cb15-38" tabindex="-1"></a>  </span>
<span id="cb15-39"><a href="#cb15-39" tabindex="-1"></a>  NumericVector out <span class="op">=</span> NumericVector<span class="op">::</span>create<span class="op">(</span>_<span class="op">[</span><span class="st">&quot;C&quot;</span><span class="op">]</span> <span class="op">=</span> C<span class="op">,</span> _<span class="op">[</span><span class="st">&quot;IC&quot;</span><span class="op">]</span> <span class="op">=</span> IC<span class="op">);</span></span>
<span id="cb15-40"><a href="#cb15-40" tabindex="-1"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb15-41"><a href="#cb15-41" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="compute_me_cpp-示例" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> 5.2
<code>compute_ME_cpp()</code> 示例</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> dat<span class="sc">$</span>beta0</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> dat<span class="sc">$</span>Sigma</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>ME_ama <span class="ot">&lt;-</span> <span class="fu">compute_ME_cpp</span>(fit_ama<span class="sc">$</span>beta_ma, beta0, Sigma)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>ME_ama</span></code></pre></div>
<pre><code>## [1] 61.02227</code></pre>
</div>
<div id="compute_c_ic_cpp-示例" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> 5.3
<code>compute_C_IC_cpp()</code> 示例</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>CIC_ama <span class="ot">&lt;-</span> <span class="fu">compute_C_IC_cpp</span>(fit_ama<span class="sc">$</span>beta_ma, beta0)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>CIC_ama</span></code></pre></div>
<pre><code>##  C IC 
## 32  5</code></pre>
</div>
<div id="速度对比r-vs-rcppmicrobenchmark" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> 5.4 速度对比：R vs
Rcpp（microbenchmark）</h2>
<p>为了做速度对比，这里在 vignette 内写一个“纯 R”的对照版本。</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>compute_ME_R <span class="ot">&lt;-</span> <span class="cf">function</span>(beta_hat, beta0, Sigma) {</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> beta_hat <span class="sc">-</span> beta0</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">t</span>(diff) <span class="sc">%*%</span> Sigma <span class="sc">%*%</span> diff)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>}</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>compute_C_IC_R <span class="ot">&lt;-</span> <span class="cf">function</span>(beta_hat, beta0, <span class="at">tol =</span> <span class="fl">1e-6</span>) {</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  is_zero_true <span class="ot">&lt;-</span> <span class="fu">abs</span>(beta0) <span class="sc">&lt;</span> tol</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  is_zero_hat  <span class="ot">&lt;-</span> <span class="fu">abs</span>(beta_hat) <span class="sc">&lt;</span> tol</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">C =</span> <span class="fu">sum</span>(is_zero_true <span class="sc">&amp;</span> is_zero_hat),</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>    <span class="at">IC =</span> <span class="fu">sum</span>(<span class="sc">!</span>is_zero_true <span class="sc">&amp;</span> is_zero_hat))</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>}</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co"># 构造一组随机输入，避免基准测试被“特例”影响</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">length</span>(beta0)</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>beta_hat_test <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> <span class="fu">rnorm</span>(p, <span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>mb <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>  <span class="at">ME_R     =</span> <span class="fu">compute_ME_R</span>(beta_hat_test, beta0, Sigma),</span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>  <span class="at">ME_cpp   =</span> <span class="fu">compute_ME_cpp</span>(beta_hat_test, beta0, Sigma),</span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>  <span class="at">C_IC_R   =</span> <span class="fu">compute_C_IC_R</span>(beta_hat_test, beta0),</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>  <span class="at">C_IC_cpp =</span> <span class="fu">compute_C_IC_cpp</span>(beta_hat_test, beta0),</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">200</span><span class="dt">L</span></span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>)</span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>mb</span></code></pre></div>
<pre><code>## Unit: microseconds
##      expr min  lq    mean median  uq    max neval cld
##      ME_R 6.0 6.4 20.8985    6.6 6.9 2693.7   200   a
##    ME_cpp 4.0 4.2  4.5850    4.3 4.5   36.8   200   a
##    C_IC_R 1.9 2.2 16.0115    2.4 2.6 2671.1   200   a
##  C_IC_cpp 1.0 1.2  1.3605    1.2 1.3   11.0   200   a</code></pre>
<table>
<caption>R vs Rcpp：microbenchmark
结果摘要（单位：microseconds）</caption>
<thead>
<tr class="header">
<th align="left">expr</th>
<th align="right">median</th>
<th align="right">mean</th>
<th align="right">min</th>
<th align="right">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ME_R</td>
<td align="right">7</td>
<td align="right">21</td>
<td align="right">6</td>
<td align="right">2694</td>
</tr>
<tr class="even">
<td align="left">ME_cpp</td>
<td align="right">4</td>
<td align="right">5</td>
<td align="right">4</td>
<td align="right">37</td>
</tr>
<tr class="odd">
<td align="left">C_IC_R</td>
<td align="right">2</td>
<td align="right">16</td>
<td align="right">2</td>
<td align="right">2671</td>
</tr>
<tr class="even">
<td align="left">C_IC_cpp</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">11</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="小结" class="section level1" number="6">
<h1><span class="header-section-number">6</span> 6. 小结</h1>
<p>本 vignette 简要说明了课程大作业中实现的 AMA Example 1
数值实验代码，包括：</p>
<ul>
<li><code>ama_fit_example1()</code>：在单个数据集上完成 AMA Step 1–6
的拟合，并返回 AMA 估计与各步骤中间结果；</li>
<li><code>sim_example1_grid()</code>：在一组 <span class="math inline">\((n, \rho, R^2)\)</span> 设定下进行 Monte Carlo
模拟，对比 AMA 与基于 ALASSO 的两种单模型选择方法；</li>
<li><code>compute_ME_cpp()</code> 与 <code>compute_C_IC_cpp()</code>：在
C++ 中高效计算模型误差和稀疏性指标，用于支持大规模模拟。</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
